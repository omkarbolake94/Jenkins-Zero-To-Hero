pipeline  {
agent { dockerfile true }

stages {

stage ('Build') {
steps {
sh 'cd java-maven-sonar-argocd-helm-k8s/spring-boot-app && mvn clean install'
sh 'sudo systemctl start docker'
}
}
stage('Sonar Scanning'){
steps{
 withSonarQubeEnv('Sonarqube') {
    sh 'cd java-maven-sonar-argocd-helm-k8s/spring-boot-app && mvn sonar:sonar'
}

}
}

stage('Build Docker Image'){
steps{
script{
sh 'cd java-maven-sonar-argocd-helm-k8s/spring-boot-app && docker build -t target/spring-boot-web.jar'
}

}
}

}
}
